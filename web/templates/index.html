<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Go2Kotlin</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />

    <style>
        :root {
            --bg-app: #f0f2f5;
            --window-bg: #ffffff;
            --border-color: #e1e4e8;
            
            /* Cores do Tema */
            --k-keyword: #d73a49;   
            --k-func: #6f42c1;      
            --k-string: #22863a;    
            --k-number: #005cc5;    
            --k-type: #d73a49;      
            --k-operator: #d73a49;  
            --k-comment: #6a737d;   
            --k-text: #24292e;      
            
            --btn-green: #28a745;
        }

        body {
            background-color: var(--bg-app);
            font-family: 'JetBrains Mono', monospace;
            margin: 0;
            padding: 20px;
            height: 100vh;
            box-sizing: border-box;
            display: flex;
            justify-content: center;
            align-items: center;
            background-image: 
                linear-gradient(90deg, #e1e4e8 1px, transparent 1px),
                linear-gradient(#e1e4e8 1px, transparent 1px);
            background-size: 40px 40px;
            overflow: hidden;
        }

        .window-frame {
            width: 95%;
            max-width: 1400px;
            height: 90vh;
            background-color: var(--window-bg);
            border-radius: 8px;
            box-shadow: 0 12px 40px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid #d1d5db;
        }

        /* --- HEADER --- */
        .title-bar {
            background: #ffffff;
            padding: 15px 20px;
            border-bottom: 2px solid #6f42c1;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
            user-select: none;
        }

        .traffic-lights { display: flex; gap: 8px; }
        .dot { width: 12px; height: 12px; border-radius: 50%; }
        .dot.red { background: #ff5f56; }
        .dot.yellow { background: #ffbd2e; }
        .dot.green { background: #27c93f; }

        .app-title { font-weight: 800; color: #24292e; letter-spacing: -0.5px; }

        /* --- TOOLBAR --- */
        .toolbar {
            padding: 10px 20px;
            background: #fafafa;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .prompt { font-size: 0.95rem; display: flex; align-items: center; gap: 0px;}
        .prompt span.user { color: var(--k-keyword); font-weight: bold; }
        .prompt span.host { color: var(--k-number); font-weight: bold; }
        .prompt span.path { color: var(--k-comment); }

        .btn-run {
            background: #fff;
            border: 2px solid var(--btn-green);
            color: var(--btn-green);
            padding: 6px 20px;
            font-family: inherit;
            font-weight: 800;
            cursor: pointer;
            border-radius: 6px;
            box-shadow: 3px 3px 0 var(--btn-green);
            transition: transform 0.1s, box-shadow 0.1s;
            text-transform: uppercase;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .btn-run:hover { background-color: var(--btn-green); color: white; }
        .btn-run:active { transform: translate(2px, 2px); box-shadow: 1px 1px 0 var(--btn-green); }

        /* --- WORKSPACE --- */
        .workspace { 
            flex: 1; 
            display: flex; 
            position: relative; 
            min-height: 0; 
            overflow: hidden;
        }

        .pane { 
            width: 50%; 
            display: flex; 
            flex-direction: column; 
            position: relative; 
            min-height: 0;
            min-width: 200px;
        }
        
        .gutter {
            width: 10px;
            background-color: #f0f0f0;
            border-left: 1px solid var(--border-color);
            border-right: 1px solid var(--border-color);
            cursor: col-resize;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            transition: background-color 0.2s;
        }

        .gutter:hover, .gutter.dragging {
            background-color: #d1d5db;
        }

        .gutter::after {
            content: "";
            height: 20px;
            width: 2px;
            background-color: #999;
            border-radius: 1px;
        }

        .lang-badge {
            position: absolute; top: 15px; right: 20px;
            padding: 4px 10px; font-size: 0.75rem; font-weight: 700;
            border-radius: 4px; z-index: 10; pointer-events: none;
            text-transform: uppercase;
            border: 1px solid;
            background: rgba(255,255,255,0.9);
        }
        .badge-go { background: #e0f2fe; color: var(--k-number); border-color: #bae6fd; }
        .badge-kt { background: #f3e8ff; color: var(--k-func); border-color: #e9d5ff; }

        .editor, pre[class*="language-"] {
            font-family: 'JetBrains Mono', monospace !important;
            
            font-size: 16px !important; 
            
            line-height: 1.6 !important;
            
            padding: 25px !important;
            margin: 0 !important;
            
            tab-size: 4 !important;
            -moz-tab-size: 4 !important;
            
            box-sizing: border-box;
            outline: none;
            overflow: auto;
            flex: 1;

            white-space: pre-wrap !important;
            word-wrap: break-word !important;
        }

        .editor {
            color: var(--k-text);
        }

        /* Cores de Sintaxe */
        .token.keyword { color: var(--k-keyword) !important; font-weight: 700; }
        .token.function, .token.package { color: var(--k-func) !important; font-weight: 700; }
        .token.builtin, .token.class-name { color: var(--k-type) !important; }
        .token.string { color: var(--k-string) !important; }
        .token.number, .token.boolean { color: var(--k-number) !important; }
        .token.operator { color: var(--k-operator) !important; background: none !important; }
        .token.comment { color: var(--k-comment) !important; }
        .token.punctuation { color: var(--k-text) !important; }

        /* Status Bar */
        .status-bar {
            background: #fafafa; border-top: 1px solid var(--border-color);
            padding: 8px 20px; font-size: 0.8rem; color: #666;
            display: flex; gap: 15px; flex-shrink: 0;
            justify-content: space-between;
        }
    </style>
</head>
<body>

    <div class="window-frame">
        <div class="title-bar">
            <div class="traffic-lights">
                <div class="dot red"></div><div class="dot yellow"></div><div class="dot green"></div>
            </div>
            <div class="app-title">GO-2-KOTLIN <span style="font-weight:400; color:#999;">v1.0</span></div>
            <div style="width: 50px;"></div>
        </div>

        <div class="toolbar">
            <div class="prompt">
                <span class="user">gopher</span>@<span class="host">go2kotlin</span>:<span class="path">~/transpiler</span>$
            </div>
            
            <button class="btn-run" onclick="runTranspiler()">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                BUILD & RUN
            </button>
        </div>

        <div class="workspace" id="workspace">
            <!-- PAINEL ESQUERDO (GO) -->
            <div class="pane" id="pane-go">
                <div class="lang-badge badge-go">GO</div>
                <div id="editor-go" class="editor language-go">package main

import "fmt"

// Definição de Struct
type Produto struct {
	Nome  string
	Preco float64
}

// Método associado à struct
func (p Produto) Detalhes() {
	fmt.Printf("Produto: %s | Valor: %.2f\n", p.Nome, p.Preco)
}

func main() {
	fmt.Println("=== Sistema de Vendas ===")

	// Criação de objeto e variáveis
	p1 := Produto{"Notebook", 3500.00}
	estoque := 5

	// Controle de fluxo (IF/ELSE)
	if estoque > 0 {
		p1.Detalhes()
	} else {
		fmt.Println("Produto esgotado!")
	}

	// Loop (FOR)
	fmt.Println("\nContando itens:")
	for i := 1; i <= 3; i++ {
		fmt.Printf("Item %d processado.\n", i)
	}
}</div>
            </div>

            <!-- DIVISOR REDIMENSIONÁVEL -->
            <div class="gutter" id="gutter"></div>

            <!-- PAINEL DIREITO (KOTLIN) -->
            <div class="pane" id="pane-kt" style="background:#fbfbfb; flex: 1; outline:none;" tabindex="0">
                <div class="lang-badge badge-kt">KOTLIN</div>
                <pre id="editor-kt" class="editor language-kotlin" style="margin:0; background:transparent;"></pre>
            </div>
        </div>

        <div class="status-bar">
            <div>STATUS: <span id="status-text" style="color:var(--btn-green); font-weight:bold;">READY</span></div>
            <div style="font-size:0.75rem; opacity:0.7;">Compiladores 2025.2 - UERN</div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-go.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-kotlin.min.js"></script>
    
    <script type="module">
        import { CodeJar } from 'https://medv.io/codejar/codejar.js';

        const editorElement = document.querySelector('#editor-go');
        const outputEl = document.getElementById('editor-kt');
        const paneKt = document.getElementById('pane-kt'); // Captura o painel direito para foco
        const statusText = document.getElementById('status-text');
        
        // --- Highlight ---
        const highlight = editor => {
            editor.textContent = editor.textContent;
            Prism.highlightElement(editor);
        };
        const jar = CodeJar(editorElement, highlight);
        Prism.highlightElement(editorElement); 

        paneKt.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'a') {
                e.preventDefault();
                
                const range = document.createRange();
                range.selectNodeContents(outputEl);
                const selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);
            }
        });

        const gutter = document.getElementById('gutter');
        const leftPane = document.getElementById('pane-go');
        const workspace = document.getElementById('workspace');
        let isResizing = false;

        gutter.addEventListener('mousedown', (e) => {
            isResizing = true;
            gutter.classList.add('dragging');
            document.body.style.cursor = 'col-resize';
            document.body.style.userSelect = 'none'; 
        });

        document.addEventListener('mousemove', (e) => {
            if (!isResizing) return;

            const containerRect = workspace.getBoundingClientRect();
            let newWidth = e.clientX - containerRect.left;
            
            if (newWidth < 100) newWidth = 100;
            if (newWidth > containerRect.width - 100) newWidth = containerRect.width - 100;

            const percent = (newWidth / containerRect.width) * 100;
            leftPane.style.width = `${percent}%`;
        });

        document.addEventListener('mouseup', () => {
            if (isResizing) {
                isResizing = false;
                gutter.classList.remove('dragging');
                document.body.style.cursor = '';
                document.body.style.userSelect = '';
            }
        });

        window.runTranspiler = async function() {
            const goCode = jar.toString();
            
            statusText.innerText = "BUILDING...";
            statusText.style.color = "#e6a700";
            
            try {
                const response = await fetch('/transpile', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code: goCode })
                });
                const data = await response.json();

                if (data.error) {
                    outputEl.textContent = "// ERRO:\n" + data.error;
                    statusText.innerText = "FAILED";
                    statusText.style.color = "#d73a49";
                } else {
                    outputEl.textContent = data.kotlin;
                    statusText.innerText = "SUCCESS";
                    statusText.style.color = "#28a745";
                }
                Prism.highlightElement(outputEl);

            } catch (err) {
                statusText.innerText = "CONNECTION ERROR";
                statusText.style.color = "#d73a49";
            }
        };
    </script>
</body>
</html>